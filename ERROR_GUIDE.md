# 🔍 오류 확인 및 해결 가이드

## 📌 목차
1. [오류 발생 위치](#1-오류-발생-위치)
2. [UI에서 오류 확인하기](#2-ui에서-오류-확인하기)
3. [터미널에서 오류 확인하기](#3-터미널에서-오류-확인하기)
4. [오류 종류별 해결 방법](#4-오류-종류별-해결-방법)
5. [자주 발생하는 오류 FAQ](#5-자주-발생하는-오류-faq)

---

## 1. 오류 발생 위치

### 앱에서 오류가 발생할 수 있는 3가지 시점:

```
📁 파일 업로드
    ↓
⚠️ [1단계] 업로드 시 검증
    - 중복 데이터 확인
    - 금액 검증
    - 컬럼 확인
    ↓
🔄 데이터 정렬
    ↓
⚠️ [2단계] 정렬 후 검증
    - 데이터 무결성 확인
    - 상호-금액 매핑 확인
    ↓
📄 PDF 생성
    ↓
⚠️ [3단계] PDF 생성 오류
    - 폰트 문제
    - 이미지 문제
```

---

## 2. UI에서 오류 확인하기

### 2-1. 파일 업로드 직후

#### ✅ 정상인 경우:
```
✅ 파일이 성공적으로 업로드되었습니다!

📊 업로드된 데이터 미리보기
(데이터 테이블 표시)
```

#### ❌ 에러가 있는 경우:
```
✅ 파일이 성공적으로 업로드되었습니다!

⚠️ 데이터 검증 결과 (확인 필요)  ← 클릭하여 펼치기
  
  ⚠️ '마마' 상가에 '벨로' 상호가 2번 중복
  
  📋 중복된 상호명 발견:
     • '벨로': 2번 (상가: 마마, 벨로)
  
  💡 같은 상호명이 여러 상가에 있는 것은 정상일 수 있으나, 
     같은 상가에 같은 상호가 중복되면 확인이 필요합니다.
```

### 📍 확인 방법:
1. 파일 업로드 직후 화면을 확인
2. **⚠️ 데이터 검증 결과** 섹션이 있는지 확인
3. 빨간색 박스 (에러) 또는 노란색 박스 (경고) 확인
4. 메시지를 읽고 엑셀 파일 수정

---

### 2-2. "데이터 정렬 및 PDF 생성" 버튼 클릭 후

#### ❌ 정렬 중 오류 발생:
```
❌ 데이터 무결성 검증 실패!

정렬 과정에서 상호-금액 매핑이 바뀌었습니다:
  • 상호 '벨루베베': 결과금액=229000, 원본금액=[1307000]
  • 상호 '벨로': 결과금액=1307000, 원본금액=[229000]

⚠️ 원본 엑셀 파일을 확인하여 데이터가 올바른지 검토해주세요.
```

### 📍 확인 방법:
1. "데이터 정렬 및 PDF 생성" 버튼 클릭
2. 처리 중... 메시지 확인
3. 빨간색 오류 메시지가 나타나는지 확인
4. 오류 내용을 읽고 원본 엑셀 파일 확인

---

### 2-3. 오류 메시지 색상 구분

#### 🔴 빨간색 (에러 - 반드시 수정)
```
❌ 데이터 무결성 검증 실패!
❌ '마마' 상가에 '벨로' 상호가 2번 중복
❌ 금액이 음수인 항목 3개 발견
```
→ **반드시 엑셀 파일을 수정해야 합니다!**

#### 🟡 노란색 (경고 - 확인 필요)
```
⚠️ 데이터 검증 결과 (확인 필요)
📋 중복된 상호명 발견
💰 금액이 0원인 항목 5개 발견
```
→ **확인 후 문제없으면 진행 가능**

#### 🔵 파란색 (정보)
```
💡 같은 상호명이 여러 상가에 있는 것은 정상일 수 있습니다.
ℹ️ 총 100개의 행이 정렬되었습니다.
```
→ **참고 정보, 문제 없음**

---

## 3. 터미널에서 오류 확인하기

### 3-1. Streamlit 실행 방법
```bash
# Windows PowerShell
streamlit run app.py

# 또는
python -m streamlit run app.py
```

### 3-2. 터미널에서 보이는 로그

#### ✅ 정상 실행:
```
You can now view your Streamlit app in your browser.

Local URL: http://localhost:8501
Network URL: http://192.168.0.1:8501
```

#### ❌ 오류 발생 시:
```
Traceback (most recent call last):
  File "app.py", line 123, in sort_data_by_number_file
    df_number = pd.read_excel(number_file_path)
FileNotFoundError: [Errno 2] No such file or directory: 'number.xlsm'
```

### 📍 터미널 로그 확인 방법:
1. Streamlit을 실행한 터미널/명령 프롬프트를 확인
2. 스크롤을 내려서 최신 로그 확인
3. 빨간색으로 표시된 오류 메시지 읽기
4. `Traceback` 부분에서 오류가 발생한 파일과 줄 번호 확인

---

## 4. 오류 종류별 해결 방법

### 4-1. 파일 업로드 오류

#### ❌ 오류: "컬럼을 찾을 수 없습니다"
```
❌ 업로드된 파일에서 '상호' 컬럼을 찾을 수 없습니다.
```

**원인**: 엑셀 파일에 필수 컬럼이 없음

**해결 방법**:
1. 엑셀 파일을 열기
2. 다음 컬럼이 있는지 확인:
   - **상가** (또는 상가명)
   - **상호** (또는 상호명)
   - **금액** (또는 입금금액, 결제금액)
3. 컬럼명이 정확히 일치하는지 확인 (띄어쓰기 포함)
4. 첫 번째 행이 헤더인지 확인

---

### 4-2. 중복 데이터 오류

#### ❌ 오류: "상호가 중복되었습니다"
```
⚠️ '마마' 상가에 '벨로' 상호가 2번 중복
```

**원인**: 같은 상가에 같은 상호가 여러 번 입력됨

**해결 방법**:
1. 엑셀 파일 열기
2. 엑셀에서 중복 찾기:
   ```
   - Ctrl+F (찾기)
   - "벨로" 검색
   - "모두 찾기" 클릭
   ```
3. 같은 상가에 같은 상호가 2개 이상 있는지 확인
4. 옵션 선택:
   - **중복이 실수인 경우**: 하나만 남기고 삭제
   - **다른 금액인 경우**: 상호명을 구분 (예: "벨로1", "벨로2")
   - **금액을 합쳐야 하는 경우**: 금액을 합산하고 1개만 남기기

---

### 4-3. 데이터 무결성 오류

#### ❌ 오류: "상호-금액 매핑이 바뀌었습니다"
```
❌ 데이터 무결성 검증 실패!
  • 상호 '벨루베베': 결과금액=229000, 원본금액=[1307000]
```

**원인**: 정렬 과정에서 데이터가 섞임 (드문 경우)

**해결 방법**:
1. **원본 엑셀 파일 재확인**
   - 엑셀에서 '벨루베베' 검색
   - 금액이 1307000인지 확인
   
2. **파일 다시 업로드**
   - 브라우저 새로고침 (F5)
   - 파일 다시 업로드
   
3. **여전히 문제가 있으면**:
   - 엑셀 파일을 새로 저장 (.xlsx 형식)
   - 앱 재시작
   - 개발자에게 문의 (엑셀 파일과 스크린샷 첨부)

---

### 4-4. number.xlsm 파일 오류

#### ❌ 오류: "number.xlsm 파일을 찾을 수 없습니다"
```
❌ C:\...\number.xlsm 파일을 찾을 수 없습니다.
```

**원인**: 정렬 기준 파일이 없거나 위치가 잘못됨

**해결 방법**:
1. `number.xlsm` 파일이 `app.py`와 같은 폴더에 있는지 확인
2. 파일명이 정확히 `number.xlsm`인지 확인 (대소문자 구분)
3. 파일이 다른 프로그램에서 열려있으면 닫기

---

### 4-5. PDF 생성 오류

#### ❌ 오류: "한글 폰트를 찾을 수 없습니다"
```
⚠️ 한글 폰트를 찾을 수 없습니다. PDF에 한글이 깨져 보일 수 있습니다.
```

**원인**: 시스템에 한글 폰트가 없음

**해결 방법**:
- **Windows**: 보통 자동으로 해결됨 (기본 폰트 사용)
- **Linux/Cloud**: 나눔고딕 폰트 설치 필요
- PDF는 생성되지만 한글이 깨질 수 있음

---

## 5. 자주 발생하는 오류 FAQ

### Q1: "데이터 검증 결과" 경고가 나타났는데 진행해도 되나요?

**A**: 경고 내용을 확인하세요.

- **같은 상가에 같은 상호 중복** → ❌ 수정 필요
- **다른 상가에 같은 상호** → ✅ 정상 (진행 가능)
- **금액 0원** → ⚠️ 확인 후 진행
- **금액 음수** → ❌ 수정 필요

---

### Q2: 엑셀 파일을 수정했는데도 같은 오류가 나타납니다.

**A**: 다음을 시도하세요.

1. **브라우저 새로고침** (F5)
2. **파일 다시 업로드** (수정된 파일인지 확인)
3. **앱 재시작**:
   ```bash
   # 터미널에서 Ctrl+C로 종료 후
   streamlit run app.py
   ```
4. **파일을 다른 이름으로 저장** 후 업로드

---

### Q3: PDF는 생성되었는데 내용이 이상합니다.

**A**: 다음을 확인하세요.

1. **정렬된 데이터 미리보기 확인**
   - "📊 정렬된 데이터 미리보기" 섹션 열기
   - 순서와 내용이 맞는지 확인
   
2. **number.xlsm 파일 확인**
   - 순서번호가 올바른지 확인
   - 상호명이 정확히 일치하는지 확인 (띄어쓰기 포함)

3. **다시 생성**
   - "데이터 정렬 및 PDF 생성" 버튼 다시 클릭
   - PDF 다시 다운로드

---

### Q4: 터미널에 빨간 글씨가 많이 나타납니다.

**A**: 당황하지 마세요!

1. **가장 아래의 오류 메시지 확인**
   - 스크롤을 맨 아래로 내리기
   - 마지막 오류 메시지 읽기

2. **주요 키워드 찾기**:
   - `FileNotFoundError` → 파일이 없음
   - `KeyError` → 컬럼명 문제
   - `ValueError` → 데이터 형식 문제
   - `PermissionError` → 파일 접근 권한 문제

3. **터미널 로그 복사**
   - 전체 로그 선택 후 복사
   - 개발자에게 문의 시 첨부

---

### Q5: 앱이 느리거나 멈춘 것 같습니다.

**A**: 다음을 확인하세요.

1. **데이터 크기 확인**
   - 100행 이상: 몇 초 소요 가능
   - 1000행 이상: 10-30초 소요 가능

2. **"처리 중..." 메시지 확인**
   - 메시지가 보이면 정상 작동 중
   - 1분 이상 걸리면 브라우저 새로고침

3. **터미널 확인**
   - 오류 메시지가 있는지 확인

---

## 📞 추가 도움이 필요한 경우

### 준비할 정보:
1. ✅ 오류 메시지 스크린샷 (UI + 터미널)
2. ✅ 엑셀 파일 (민감한 정보 제거 후)
3. ✅ 어떤 단계에서 오류가 발생했는지
4. ✅ 이미 시도한 해결 방법

### 문의 방법:
- GitHub Issues: https://github.com/jihun2da/envelope-printing-system/issues
- 위 정보를 첨부하여 이슈 생성

---

## 🎯 오류 예방 체크리스트

### 파일 업로드 전:
- [ ] 엑셀 파일에 필수 컬럼 있음 (상가, 상호, 금액)
- [ ] 같은 상가에 같은 상호 중복 없음
- [ ] 금액이 모두 양수임
- [ ] 상호명에 오타 없음
- [ ] 띄어쓰기가 일관됨

### 정렬 후:
- [ ] 정렬된 데이터 미리보기 확인
- [ ] 순서가 맞는지 확인
- [ ] 금액이 올바른지 확인

### PDF 생성 후:
- [ ] PDF 열어서 내용 확인
- [ ] 상호명과 금액이 맞는지 확인
- [ ] 순서가 올바른지 확인

---

**마지막 업데이트**: 2026-02-02  
**버전**: v1.1
